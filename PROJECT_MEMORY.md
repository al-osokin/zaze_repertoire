# Память проекта

## Реализовано

- **Парсинг и наполнение афиши**: `scraper.php` загружает расписание с сайта театра, очищает данные выбранного месяца и сохраняет их в `events_raw`. Невыбранные спектакли можно сопоставить вручную. Главная (`index.php`) выступает стартовым меню с быстрым доступом к парсеру и админке спектаклей.
- **Управление спектаклями и шаблонами**: админ-панель поддерживает редактирование записей в `plays`, хранит шаблоны карточек (`play_templates`), удаляет дубликаты. Для шаблонов реализован класс `app/Models/PlayTemplateParser.php`, который разбирает wiki-разметку, создаёт роли и заполняет стартовый состав.
- **Система артистов и ролей**: введены таблицы `artists`, `roles`, `performance_roles_artists`, `role_artist_history`, а также `play_role_last_cast` для хранения последнего утверждённого состава спектакля. Дубликаты и артефакты («… впервые в роли», неправильные групповые записи, ошибки парсинга) очищены; парсер теперь вырезает такие пометки автоматически.
- **Редактор состава (`edit_cast.php`)**: страница автозаполняет роли из шаблона или последнего сохранённого состава, поддерживает выбор из «частых» артистов, создание новых исполнителей (включая коллективы типа `group`), отметку «впервые в роли» и сохранение истории. Добавлено подтягивание последнего состава и горячая кнопка на афише для копирования готовой карточки.
- **Генерация карточек**: кнопка «Сгенерировать и сохранить карточку» формирует wiki-разметку по текущему составу, обновляет текст для VK и одновременно запоминает этот состав для будущих показов; на афише можно скопировать последнюю карточку без захода внутрь спектакля.
- **База данных**: расширен ENUM `artists.type` (добавлен `group`), очищены ошибочные записи и дубли, вручную восстановлены сложные роли («Путешествие муравьишки…» и др.), настроен экспорт базы `avo_zaze_backup_*.sql`.

## Текущее состояние

- Афиша успешно наполняется, но автосохранение версий в `repertoire_history` ещё не реализовано.
- Карточки спектаклей создаются из UI, однако экспорт/публикация в VK остаётся вручную.
- Поддержка тестов и CI/CD отсутствует; проверки производятся вручную.

## Запланированные улучшения

1. **Автосохранение генераций афиши**: добавить опцию на `scraper.php`, чтобы wiki/TSV сразу записывались в `repertoire_history`.
2. **Публикация в VK**: интегрировать VK API для отправки готовых карточек из интерфейса.
3. **Улучшение истории составов**: добавить просмотр и откат предыдущих составов спектакля.
4. **Тестирование**: подготовить базовый набор автоматических тестов (парсер шаблонов, генерация карточек, сохранение составов).
