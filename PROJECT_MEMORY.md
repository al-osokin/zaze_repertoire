# Память проекта

## Реализовано

- **Парсинг афиши**: `scraper.php` загружает расписание с сайта театра, очищает данные выбранного месяца и сохраняет их в `events_raw`. Невыбранные спектакли можно сопоставить вручную.
- **WikiGenerator**: отдельный класс (`wiki_generator.php`) формирует wiki-таблицу и табличный источник на основе подтверждённых событий, учитывая абонементы и дубликаты в один день.
- **Работа со спектаклями**: `plays` содержит поле `site_title`, используемое для точного сопоставления. Админка показывает названия на сайте, поддерживает редактирование, шаблоны и удаление дублей.
- **Обновлённая навигация**: главная страница (`index.php`) стала стартовым меню с быстрой ссылкой на парсер, ручное создание и управление спектаклями. Страница `manual.php` оставляет возможность ручного преобразования старых черновиков.
- **База данных**: добавлена колонка `site_title`, убраны дубликаты («Любовный/Напиток»), экспорт рабочей базы доступен в `avo_zaze_new.sql`.

## Текущее состояние

- Генерация афиши возвращает текст на странице, но не сохраняет автоматически версии в `repertoire_history`.
- Таблица `repertoire_history` хранит старые записи; интерфейс истории используется только для просмотра ранее сохранённых черновиков.
- VK-интеграция и автоматическая публикация пока не реализованы.

## Запланированные улучшения

1. **Автосохранение результатов**: добавить кнопку/опцию на `scraper.php`, чтобы отправлять сгенерированные wiki/TSV в `repertoire_history`.
2. **Шаблоны ролей**: привязать `WikiGenerator` к `play_templates`, чтобы формировать страницы «в ролях» в автоматическом режиме.
3. **VK API**: реализовать авторизацию и публикацию афиши в группу ВКонтакте напрямую из интерфейса.
4. **Очистка истории**: решить, какие данные из старой системы необходимо сохранить/удалить, и обновить UI `history.php` под новый процесс.
5. **Тесты**: подготовить минимальный набор автоматических тестов (например, для генератора wiki и нормализации названий).
