# Системные паттерны проекта "Администрирование Афиши Театра"

## Архитектура системы:
Система представляет собой веб-приложение на PHP с использованием базы данных MariaDB.
*   **Фронтенд:** PHP-страницы с HTML/CSS/JS (возможно, с использованием Tailwind CSS).
*   **Бэкенд:** PHP-скрипты и классы для работы с базой данных, парсинга и генерации контента.
*   **База данных:** MariaDB (MySQL-совместимая) для хранения всех данных.

## Ключевые технические решения:
*   **Парсинг шаблонов:** Используется класс `PlayTemplateParser` для извлечения ролей и артистов из вики-разметки шаблонов.
*   **Управление данными:** Функции для работы с БД сосредоточены в `db.php`.
*   **Аутентификация:** Простая система аутентификации по логину/паролю.
*   **Генерация вики-разметки:** Класс `WikiGenerator` (`wiki_generator.php`) для формирования афиши.

## Используемые паттерны проектирования:
*   **Active Record / Data Mapper (частично):** Функции в `db.php` и методы в `PlayTemplateParser` взаимодействуют с БД, но не являются полноценными ORM.
*   **Singleton (для PDO):** Подключение к БД, вероятно, реализовано как синглтон через `getDBConnection()`.
*   **Service Layer (для парсера):** `PlayTemplateParser` действует как сервисный класс, инкапсулирующий бизнес-логику парсинга.

## Взаимосвязи компонентов:
*   `scraper.php`: Использует функции из `db.php` для сохранения `events_raw` и `WikiGenerator` для формирования афиши.
*   `admin.php`: Взаимодействует с `db.php` для управления спектаклями и шаблонами.
*   `PlayTemplateParser.php`: Использует `db.php` для сохранения ролей и артистов.
*   `edit_cast.php` (планируемый): Будет использовать `db.php` для получения и сохранения данных о составе, а также `PlayTemplateParser` для инициализации ролей.

## Критические пути реализации:
*   **Корректный парсинг шаблонов:** Точное извлечение ролей и артистов из разнообразных форматов вики-разметки.
*   **Эффективное управление составом:** Удобный и быстрый интерфейс для назначения артистов.
*   **Надежная генерация карточек:** Формирование корректной вики-разметки с учетом всех назначений.
*   **Целостность данных:** Обеспечение согласованности данных между таблицами `plays`, `roles`, `artists`, `events_raw`, `performance_roles_artists`, `role_artist_history`.
