# Temza Puppeteer Workspace

Node.js playground for автоматизация выгрузки составов из Temza и подготовки JSON, который затем потребляется PHP‑сервисом афиши.

## Быстрый старт
1. `cd temza_scraper`
2. `cp .env.example .env` и заполните Temza логин/пароль. При необходимости поправьте `TEMZA_MONTH_URL_TEMPLATE`.
3. `npm install` (уже выполнено, но команда понадобится после обновлений зависимостей).
4. Однократно скачайте Chrome для Puppeteer: `npx puppeteer browsers install chrome`.
5. (Опционально) укажите `PUPPETEER_EXECUTABLE_PATH`, если свой бинарь лежит в нестандартном месте (`.env`).
6. `npm run dev` — авторизация, переход на выбранные месяцы, обход всех спектаклей с префиксом `Сп.` и сохранение JSON в `output/temza-YYYY-MM.json`.

## Скрипты
- `npm run dev -- --months=current,next` — последовательно собирает два месяца (по умолчанию текущий+следующий) и сохраняет результат в `output/`.
- Можно указать конкретные месяцы: `npm run dev -- --months=2025-11,2025-12`.
  В учёт берутся только карточки, чьи заголовки начинаются на «Сп.» или «АБОНЕМЕНТ…»; «ЦЕЛЕВОЙ», репетиции, монтажи и т.п. автоматически пропускаются.

### CLI-параметры
- `--month YYYY-MM` или `-m YYYY-MM` — одиночный месяц.
- `--months list` — список через запятую. Допустимы `current`, `next`, а также явные `YYYY-MM`. По умолчанию берётся пара `current,next`.
- `--outDir path` или `-o path` — каталог для сохранения JSON (по умолчанию `temza_scraper/output`).

## Структура
- `src/config.js` — загрузка переменных окружения и базовые настройки Puppeteer.
- `src/browser.js` — единая точка запуска браузера/страниц.
- `src/selectors.js` — плейсхолдеры для CSS‑селекторов Temza (заполните по итогам инспекции через DevTools/Browser MCP).
- `src/temzaClient.js` — функции логина и навигации по Temza, на основе текущего плана.
- `src/index.js` — CLI-точка входа, которая открывает нужные месяцы и сохраняет результаты в файлы.
- `src/parser.js` — извлекает структуру JSON из HTML попапа (состав, ответственные, задачи цехам, вызваны, заметки, raw HTML).

## Дальнейшие шаги
- Сопоставить выгруженные JSON-страктуры с карточками спектаклей в PHP и построить маппинг ролей/камер.
- Добавить фильтры или дополнительные поля (например, тип события) прямо при постобработке JSON, чтобы минимизировать повторные запросы к Temza.
